promotion.StoreAssoc.Sql = SELECT HEADER.AD_EVENT_TYPE_CD,  HEADER.AD_EVENT_SEQ_ID , HEADER.AD_EVENT_REL_IND, COUPAN.PLU_COUPON_NBR, COUPAN.AD_EVENT_START_DT, COUPAN.AD_EVENT_END_DT, STORE.LOCATION_NBR FROM OM_AD_EVENT_HEADER_STG HEADER INNER JOIN OM_AD_EVENT_COUPONS_STG COUPAN ON HEADER.AD_EVENT_TYPE_CD \= COUPAN.AD_EVENT_TYPE_CD INNER JOIN OM_AD_EVENT_STORES_STG  STORE ON COUPAN.AD_EVENT_TYPE_CD \= STORE.AD_EVENT_TYPE_CD AND HEADER.AD_EVENT_SEQ_ID \= COUPAN.AD_EVENT_SEQ_ID AND COUPAN.AD_EVENT_SEQ_ID \= STORE.AD_EVENT_SEQ_ID AND COUPAN.AD_EVENT_PRNTVER_CD \= STORE.AD_EVENT_PRNTVER_CD WHERE HEADER.FEEDFILE_RCVD_DTTM \= TO_DATE( ? ,'DD-MON-YY\:HH24\:MI\:SS') and COUPAN.FEEDFILE_RCVD_DTTM \= TO_DATE( ? ,'DD-MON-YY\:HH24\:MI\:SS') and STORE.FEEDFILE_RCVD_DTTM \= TO_DATE( ? ,'DD-MON-YY\:HH24\:MI\:SS') GROUP BY HEADER.AD_EVENT_TYPE_CD,  HEADER.AD_EVENT_SEQ_ID , HEADER.AD_EVENT_REL_IND, COUPAN.PLU_COUPON_NBR, COUPAN.AD_EVENT_START_DT, COUPAN.AD_EVENT_END_DT, STORE.LOCATION_NBR ORDER BY HEADER.AD_EVENT_TYPE_CD,  HEADER.AD_EVENT_SEQ_ID , HEADER.AD_EVENT_REL_IND, COUPAN.PLU_COUPON_NBR, COUPAN.AD_EVENT_START_DT, COUPAN.AD_EVENT_END_DT, STORE.LOCATION_NBR
#Header table insert query
promotion.HeaderInsert.Sql = INSERT INTO OM_AD_EVENT_HEADER_STG (AD_EVENT_TYPE_CD, AD_EVENT_SEQ_ID, AD_EVENT_DATE_STMP, AD_EVENT_TIME_STMP, AD_EVENT_USER_STMP, AD_EVENT_REL_IND, AD_EVENT_PRCS_IND, FEEDFILE_RCVD_DTTM) values (\:advEventType, \:advEventSeqNbr, \:adEventDateStmp, \:adEventTimeStmp, \:adEventUserStmp, \:adEventRelInd, \:adEventPrcsInd, \:recvDTTM )
#Coupon table insert query
promotion.CouponInsert.Sql = INSERT INTO OM_AD_EVENT_COUPONS_STG (AD_EVENT_TYPE_CD, AD_EVENT_SEQ_ID,AD_EVENT_PRNTVER_CD, ITEM_NUMBER, PLU_COUPON_NBR, AD_EVENT_START_DT,AD_EVENT_END_DT,VERSION_STATUS_CD,FEEDFILE_RCVD_DTTM) values (\:advEventType, \:advEventSeqNbr, \:advPrintVerNbr,\:itemNumber, \:advItemCouponNbr, \:advEvVerStartDate, \:advEvVerEndDate, \:advEvVerStatus, \:recvDTTM )
							
#Store table insert query
promotion.StoreInsert.Sql = INSERT INTO OM_AD_EVENT_STORES_STG (AD_EVENT_TYPE_CD, AD_EVENT_SEQ_ID, AD_EVENT_PRNTVER_CD, LOCATION_TYPE, LOCATION_NBR,FEEDFILE_RCVD_DTTM) values ( \:advEventType,\:advEventSeqNbr, \:advPrintVerNbr, \:locationType, \:advLocationNbr, \:recvDTTM )


#TIME_AND_ATTENDANCE_POPULATE_DATA
TIME_AND_ATTENDANCE_POPULATE_DATA =   SELECT COUNT(*) OVER() AS TOTAL_RECORDS , EMPLOYEE_ID          AS EMPLOYEE_ID, SUM(EARNED_AMOUNT)   AS DOLLAR_PM_AMOUNT, EFFECTIVE_DATE , LOCATION_NBR AS STORE_NUMBER , SYS_ORDER_ID FROM (SELECT e.EMPLOYEE_ID,  D.LOCATION_NBR, A.EARNED_AMOUNT,  A.TIME_ATTENDANCE_CD,  A.REPORT_SENT_DTTM,  NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS EFFECTIVE_DATE, A.SYS_ORDER_ID, 'ORDER' AS Type, C.SYS_ORDER_ATTRIBUTE_ID  FROM OM_ORDER_PM A,  OM_ORDER B,  OM_ORDER_ATTRIBUTE C, OM_LOCATION D,  OM_USER_ATTRIBUTES E WHERE A.Sys_Order_Id         = B.Sys_Order_Id  AND A.ORDER_PLACED_DTTM    = B.ORDER_PLACED_DTTM AND B.SYS_ORDER_ID         = C.SYS_ORDER_ID AND B.ORDER_PLACED_DTTM    = C.ORDER_PLACED_DTTM AND B.SYS_OWNING_LOC_ID    = D.SYS_LOCATION_ID AND A.Sys_Employee_Id      = E.Sys_User_Id AND A.Sys_Product_Id      <> 0 AND ((C.Pm_Status          = 'E' AND (A.Time_Attendance_Cd IS NULL AND A.REPORT_SENT_DTTM    IS NULL) OR (A.Time_Attendance_Cd   = 'I' AND A.REPORT_SENT_DTTM    IS NOT NULL)) OR (C.Pm_Status            = 'T' AND A.Time_Attendance_Cd   = 'R' AND A.REPORT_SENT_DTTM    IS NOT NULL)) AND C.Order_Placed_Dttm    > Sysdate - 210 AND A.ACTIVE_CD            = 1 UNION ALL SELECT e.EMPLOYEE_ID,  D.LOCATION_NBR, A.EARNED_AMOUNT, A.TIME_ATTENDANCE_CD,  A.REPORT_SENT_DTTM, NVL(B.Order_Sold_Dttm,Sysdate - 1) AS Effective_Date, A.SYS_ORDER_ID, 'SC' AS TYPE, F.SYS_SHOPPING_CART_ID FROM OM_ORDER_PM A, Om_Order B, OM_ORDER_ATTRIBUTE C, OM_SHOPPING_CART F, OM_LOCATION D,  OM_USER_ATTRIBUTES E WHERE A.Sys_Order_Id         = B.Sys_Order_Id AND A.Order_Placed_Dttm    = B.Order_Placed_Dttm AND B.Sys_Order_Id         = C.Sys_Order_Id AND B.Order_Placed_Dttm    = C.Order_Placed_Dttm AND C.SYS_SHOPPING_CART_ID = F.SYS_SHOPPING_CART_ID AND C.ORDER_PLACED_DTTM    = F.ORDER_PLACED_DTTM AND B.SYS_OWNING_LOC_ID    = D.SYS_LOCATION_ID AND A.SYS_EMPLOYEE_ID      = E.SYS_USER_ID AND A.Sys_Product_Id       = 0 AND ((F.PM_STATUS_CD       = 'E' AND (A.Time_Attendance_Cd IS NULL AND A.REPORT_SENT_DTTM    IS NULL)  OR (A.Time_Attendance_Cd   = 'I' AND A.REPORT_SENT_DTTM    IS NOT NULL)) OR (F.PM_STATUS_CD         = 'T' AND A.Time_Attendance_Cd   = 'R' AND A.REPORT_SENT_DTTM    IS NOT NULL))  AND C.ORDER_PLACED_DTTM    > SYSDATE - 210 AND A.ACTIVE_CD            = 1 ) GROUP BY EMPLOYEE_ID, LOCATION_NBR, Sys_Order_Id, EFFECTIVE_DATE         
									
#UPDATE_OM_ORDER_PM
UPDATE_OM_ORDER_PM = update om_order_pm set time_attendance_cd = 'Y' where  time_attendance_cd ='I' and ORDER_PLACED_DTTM  > SYSDATE - 210

#UPDATE_OM_SHOPPING_CART = 
UPDATE_OM_SHOPPING_CART = UPDATE OM_SHOPPING_CART SET PM_STATUS_CD = 'T' WHERE ORDER_PLACED_DTTM   > SYSDATE - 210 AND SYS_SHOPPING_CART_ID IN (SELECT ORD_ATTR.SYS_SHOPPING_CART_ID FROM OM_ORDER_ATTRIBUTE ORD_ATTR, OM_ORDER_PM OPM WHERE ORD_ATTR.SYS_ORDER_ID = OPM.SYS_ORDER_ID AND OPM.ORDER_PLACED_DTTM = ORD_ATTR.ORDER_PLACED_DTTM  AND ORD_ATTR.ORDER_PLACED_DTTM > SYSDATE - 210 AND OPM.TIME_ATTENDANCE_CD = 'Y' AND OPM.Sys_Product_Id   = 0)
						   
#UPDATE_OM_ORDER_ATTRIBUTE 						   							
UPDATE_OM_ORDER_ATTRIBUTE = UPDATE OM_ORDER_ATTRIBUTE SET PM_STATUS = 'T' WHERE SYS_ORDER_ID IN (SELECT SYS_ORDER_ID FROM OM_ORDER_PM WHERE TIME_ATTENDANCE_CD = 'Y' AND ORDER_PLACED_DTTM    > SYSDATE - 210) AND ORDER_PLACED_DTTM > SYSDATE - 210
#----------------------------- KPI SQL QUERY  STARTS--------------------------------------------#

# SQL for the stat id : PHALCSDT, PHALTOS, PHALCCDT
kpi.populateKPITransaction1.storewise.sql=WITH QUERY1 AS(SELECT LOC.LOCATION_NBR,TO_CHAR(POS.BUSINESS_DATE, 'mm/dd/yyyy') AS BUSINESS_DATE,CASE WHEN POS.SYS_ORDER_ID IS NULL THEN (POS.SOLD_AMT* 0.4) ELSE ORDATT.COST END AS COST,POS.SOLD_AMT AS SOLD_AMT,POS.ENVELOPE_NBR AS ENVELOPE_NBR,POS.SYS_ORDER_ID FROM OM_POS_TRANSACTION POS,OM_LOCATION LOC,OM_ORDER_ATTRIBUTE ORDATT WHERE POS.SYS_LOCATION_ID = LOC.SYS_LOCATION_ID AND POS.SYS_ORDER_ID = ORDATT.SYS_ORDER_ID (+) )SELECT LOCATION_NBR,BUSINESS_DATE,SUM(COST) AS COST,SUM(SOLD_AMT) AS SOLD_AMT,COUNT(DISTINCT ENVELOPE_NBR) AS ENVELOPE_NBR FROM QUERY1 WHERE EXISTS (SELECT 1 FROM OM_POS_TRANSACTION WHERE QUERY1.BUSINESS_DATE = TO_CHAR(OM_POS_TRANSACTION.BUSINESS_DATE, 'mm/dd/yyyy') AND KPI_INDICATOR_FLAG = 'I')GROUP BY LOCATION_NBR,BUSINESS_DATE
kpi.populateKPITransaction1.allstore.sql=WITH QUERY1 AS(SELECT LOC.LOCATION_NBR,TO_CHAR(POS.BUSINESS_DATE, 'mm/dd/yyyy') AS BUSINESS_DATE,CASE WHEN POS.SYS_ORDER_ID IS NULL THEN (POS.SOLD_AMT* 0.4) ELSE ORDATT.COST END AS COST,POS.SOLD_AMT AS SOLD_AMT,POS.ENVELOPE_NBR AS ENVELOPE_NBR,POS.SYS_ORDER_ID FROM OM_POS_TRANSACTION POS,OM_LOCATION LOC,OM_ORDER_ATTRIBUTE ORDATT WHERE POS.SYS_LOCATION_ID = LOC.SYS_LOCATION_ID AND POS.SYS_ORDER_ID = ORDATT.SYS_ORDER_ID (+) )SELECT LOCATION_NBR,BUSINESS_DATE,SUM(COST) AS COST,SUM(SOLD_AMT) AS SOLD_AMT,COUNT(DISTINCT ENVELOPE_NBR) AS ENVELOPE_NBR FROM QUERY1 WHERE EXISTS (SELECT 1 FROM OM_POS_TRANSACTION WHERE QUERY1.BUSINESS_DATE = TO_CHAR(OM_POS_TRANSACTION.BUSINESS_DATE, 'mm/dd/yyyy') AND KPI_INDICATOR_FLAG = 'I')GROUP BY LOCATION_NBR,BUSINESS_DATE
# SQL for the stat id : PHALDPMS, PHALDPMP
kpi.populateKPITransaction2.storewise.sql=WITH QUERY1 AS (SELECT OM_ORDER_LINE.FINAL_PRICE AS FINAL_PRICE,OM_ORDER_PM.EARNED_AMOUNT AS EARNED_AMOUNT,OM_LOCATION.LOCATION_NBR,TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM, 'mm/dd/yyyy') AS SOLD_DTTM FROM OM_ORDER,OM_ORDER_PM,OM_ORDER_LINE,OM_LOCATION WHERE OM_ORDER.ORDER_PLACED_DTTM > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND OM_ORDER_PM.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER_PM.SYS_ORDER_ID = OM_ORDER.SYS_ORDER_ID AND OM_ORDER_LINE.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_ORDER_LINE.SYS_PRODUCT_ID = OM_ORDER_PM.SYS_PRODUCT_ID AND OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID AND OM_ORDER_PM.SYS_PRODUCT_ID <> 0 UNION ALL SELECT OM_ORDER.FINAL_PRICE AS FINAL_PRICE,OM_ORDER_PM.EARNED_AMOUNT AS EARNED_AMOUNT,OM_LOCATION.LOCATION_NBR, TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM, 'mm/dd/yyyy') AS SOLD_DTTM FROM OM_ORDER,OM_ORDER_PM,OM_LOCATION WHERE OM_ORDER.ORDER_PLACED_DTTM  > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND OM_ORDER_PM.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER_PM.SYS_ORDER_ID = OM_ORDER.SYS_ORDER_ID AND OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID AND OM_ORDER_PM.SYS_PRODUCT_ID = 0),QUERY2 AS (SELECT FINAL_PRICE,EARNED_AMOUNT,LOCATION_NBR, CASE WHEN SOLD_DTTM IS NULL THEN TO_CHAR((SYSDATE -1),'mm/dd/yyyy') ELSE SOLD_DTTM END AS SOLD_DTTM FROM QUERY1 WHERE EXISTS (SELECT 1 FROM OM_ORDER,OM_ORDER_PM WHERE OM_ORDER.ORDER_PLACED_DTTM > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND (QUERY1.SOLD_DTTM IS NULL OR QUERY1.SOLD_DTTM = TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM,'mm/dd/yyyy')) AND OM_ORDER.SYS_ORDER_ID = OM_ORDER_PM.SYS_ORDER_ID AND KPI_INDICATOR_FLAG = 'I'))SELECT SUM(FINAL_PRICE) AS FINAL_PRICE,SUM(EARNED_AMOUNT) AS EARNED_AMOUNT,LOCATION_NBR,SOLD_DTTM FROM QUERY2 GROUP BY QUERY2.LOCATION_NBR,QUERY2.SOLD_DTTM ORDER BY QUERY2.SOLD_DTTM
kpi.populateKPITransaction2.allstore.sql=WITH QUERY1 AS (SELECT OM_ORDER_LINE.FINAL_PRICE AS FINAL_PRICE,OM_ORDER_PM.EARNED_AMOUNT AS EARNED_AMOUNT,OM_LOCATION.LOCATION_NBR,TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM, 'mm/dd/yyyy') AS SOLD_DTTM FROM OM_ORDER,OM_ORDER_PM,OM_ORDER_LINE,OM_LOCATION WHERE OM_ORDER.ORDER_PLACED_DTTM > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND OM_ORDER_PM.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER_PM.SYS_ORDER_ID = OM_ORDER.SYS_ORDER_ID AND OM_ORDER_LINE.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_ORDER_LINE.SYS_PRODUCT_ID = OM_ORDER_PM.SYS_PRODUCT_ID AND OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID AND OM_ORDER_PM.SYS_PRODUCT_ID <> 0 UNION ALL SELECT OM_ORDER.FINAL_PRICE AS FINAL_PRICE,OM_ORDER_PM.EARNED_AMOUNT AS EARNED_AMOUNT,OM_LOCATION.LOCATION_NBR, TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM, 'mm/dd/yyyy') AS SOLD_DTTM FROM OM_ORDER,OM_ORDER_PM,OM_LOCATION WHERE OM_ORDER.ORDER_PLACED_DTTM  > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND OM_ORDER_PM.ORDER_PLACED_DTTM = OM_ORDER.ORDER_PLACED_DTTM AND OM_ORDER_PM.SYS_ORDER_ID = OM_ORDER.SYS_ORDER_ID AND OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID AND OM_ORDER_PM.SYS_PRODUCT_ID = 0),QUERY2 AS (SELECT FINAL_PRICE,EARNED_AMOUNT,LOCATION_NBR, CASE WHEN SOLD_DTTM IS NULL THEN TO_CHAR((SYSDATE -1),'mm/dd/yyyy') ELSE SOLD_DTTM END AS SOLD_DTTM FROM QUERY1 WHERE EXISTS (SELECT 1 FROM OM_ORDER,OM_ORDER_PM WHERE OM_ORDER.ORDER_PLACED_DTTM > (TO_DATE(?, 'mmddyyyy hh24:mi:ss') - 195) AND (QUERY1.SOLD_DTTM IS NULL OR QUERY1.SOLD_DTTM = TO_CHAR(OM_ORDER.ORDER_SOLD_DTTM,'mm/dd/yyyy')) AND OM_ORDER.SYS_ORDER_ID = OM_ORDER_PM.SYS_ORDER_ID AND KPI_INDICATOR_FLAG = 'I'))SELECT SUM(FINAL_PRICE) AS FINAL_PRICE,SUM(EARNED_AMOUNT) AS EARNED_AMOUNT,LOCATION_NBR,SOLD_DTTM FROM QUERY2 GROUP BY QUERY2.LOCATION_NBR,QUERY2.SOLD_DTTM ORDER BY QUERY2.SOLD_DTTM
# SQL for the stat id : PHALPTOH, PHALCTOH
kpi.populateKPITransaction3.storewise.sql=WITH NUM_TEMP AS(SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM >= CASE WHEN O.ORDER_COMPLETED_DTTM IS NOT NULL THEN O.ORDER_COMPLETED_DTTM ELSE O.ORDER_SOLD_DTTM END AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL', 'PROC') AND OA.PROCESSING_TYPE_CD ='H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL  AND O.ORDER_ORIGIN_TYPE NOT IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), NUM AS (SELECT * FROM NUM_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND NUM_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')),DENO_TEMP AS (SELECT COUNT(ORDER_NBR) DENO_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE NOT IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT * FROM DENO_TEMP WHERE EXISTS(SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND DENO_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPTOH, NUM.NUM_COUNT PHALCTOH, DENO.DENO_COUNT PHALPTOH_SIZE, DENO.STORE_NBR, DENO.DATE_TIME FROM NUM, DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME And  NUM.STORE_NBR (+) =  DENO.STORE_NBR
kpi.populateKPITransaction3.allstore.sql=WITH NUM AS (SELECT COUNT(ORDER_NBR) NUM_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O, OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM >= CASE WHEN O.ORDER_COMPLETED_DTTM IS NOT NULL THEN O.ORDER_COMPLETED_DTTM ELSE O.ORDER_SOLD_DTTM END AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL', 'PROC') AND OA.PROCESSING_TYPE_CD ='H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE NOT IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT COUNT(ORDER_NBR) DENO_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O, OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE NOT IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPTOH, NUM.NUM_COUNT PHALCTOH, DENO.DENO_COUNT PHALPTOH_SIZE, DENO.STORE_NBR, DENO.DATE_TIME FROM NUM, DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
# SQL for the stat id : PHALPINT, PHALCINT
kpi.populateKPITransaction4.storewise.sql=WITH NUM_TEMP AS(SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM >= CASE WHEN O.ORDER_COMPLETED_DTTM IS NOT NULL THEN O.ORDER_COMPLETED_DTTM ELSE O.ORDER_SOLD_DTTM END AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL', 'PROC') AND OA.PROCESSING_TYPE_CD ='H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL  AND O.ORDER_ORIGIN_TYPE IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), NUM AS (SELECT * FROM NUM_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND NUM_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')),DENO_TEMP AS (SELECT COUNT(ORDER_NBR) DENO_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT * FROM DENO_TEMP WHERE EXISTS(SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND DENO_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPINT, NUM.NUM_COUNT PHALCINT, DENO.DENO_COUNT PHALPINT_SIZE, DENO.STORE_NBR, DENO.DATE_TIME FROM NUM, DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME And  NUM.STORE_NBR (+) = DENO.STORE_NBR
kpi.populateKPITransaction4.allstore.sql=WITH NUM AS (SELECT COUNT(ORDER_NBR) NUM_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O, OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM >=  CASE WHEN O.ORDER_COMPLETED_DTTM IS NOT NULL THEN O.ORDER_COMPLETED_DTTM ELSE O.ORDER_SOLD_DTTM END AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL', 'PROC') AND OA.PROCESSING_TYPE_CD ='H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT COUNT(ORDER_NBR) DENO_COUNT, OL.LOCATION_NBR STORE_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy') AS DATE_TIME FROM OM_ORDER O, OM_ORDER_ATTRIBUTE OA, OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.PROMISE_DELIVERY_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.PROMISE_DELIVERY_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM > TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') - 195 AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND OA.EXPENSE_CD != 1 AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.ORDER_ORIGIN_TYPE IN ('Internet','Mobile') AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR, TO_CHAR(O.PROMISE_DELIVERY_DTTM, 'mm/dd/yyyy')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPINT, NUM.NUM_COUNT PHALCINT, DENO.DENO_COUNT PHALPINT_SIZE, DENO.STORE_NBR, DENO.DATE_TIME FROM NUM, DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+) = DENO.STORE_NBR
# SQL for the stat id : PHALPPTA
kpi.populateKPITransaction5.storewise.sql=WITH NUM_TEMP AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') and O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') and O.PROMISE_DELIVERY_DTTM >= O.ORDER_PLACED_DTTM AND O.PROMISE_DELIVERY_DTTM <= (O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(1 , 'HOUR')) AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), NUM AS (SELECT * FROM NUM_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND NUM_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')), DENO_TEMP AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT * FROM DENO_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND DENO_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPPTA,DENO.DENO_COUNT PHALPPTA_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
kpi.populateKPITransaction5.allstore.sql=WITH NUM AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') and O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') and O.PROMISE_DELIVERY_DTTM >= O.ORDER_PLACED_DTTM AND O.PROMISE_DELIVERY_DTTM <= (O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(1 , 'HOUR')) AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPPTA,DENO.DENO_COUNT PHALPPTA_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
# SQL for the stat id : PHALPPTB
kpi.populateKPITransaction6.storewise.sql=WITH NUM_TEMP AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') and O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') and O.PROMISE_DELIVERY_DTTM > (O.ORDER_PLACED_DTTM   + NUMTODSINTERVAL(1 , 'HOUR')) AND O.PROMISE_DELIVERY_DTTM <= (O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(2 , 'HOUR')) AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), NUM AS (SELECT * FROM NUM_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND NUM_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')), DENO_TEMP AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), DENO as (SELECT * FROM DENO_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND DENO_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= sysdate AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPPTB,DENO.DENO_COUNT PHALPPTB_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
kpi.populateKPITransaction6.allstore.sql=WITH NUM AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') and O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') and O.PROMISE_DELIVERY_DTTM > (O.ORDER_PLACED_DTTM   + NUMTODSINTERVAL(1 , 'HOUR')) AND O.PROMISE_DELIVERY_DTTM <= (O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(2 , 'HOUR')) AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')),DENO AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM and O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0) PHALPPTB,DENO.DENO_COUNT PHALPPTB_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
# SQL for the stat id : PHALPPTC
kpi.populateKPITransaction7.storewise.sql=WITH NUM_TEMP AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.PROMISE_DELIVERY_DTTM > O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(2 , 'HOUR') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), NUM AS (SELECT * FROM NUM_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND NUM_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')), DENO_TEMP AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT * FROM DENO_TEMP WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER,OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND DENO_TEMP.STORE_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE (OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KPI')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0)PHALPPTC,DENO.DENO_COUNT PHALPPTC_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
kpi.populateKPITransaction7.allstore.sql=WITH NUM AS (SELECT COUNT(ORDER_NBR) NUM_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.PROMISE_DELIVERY_DTTM > O.ORDER_PLACED_DTTM + NUMTODSINTERVAL(2 , 'HOUR') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD ='H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')), DENO AS (SELECT COUNT(ORDER_NBR) DENO_COUNT,OL.LOCATION_NBR STORE_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy') DATE_TIME FROM OM_ORDER O,OM_ORDER_ATTRIBUTE OA,OM_LOCATION OL WHERE O.ORDER_PLACED_DTTM = OA.ORDER_PLACED_DTTM AND O.SYS_ORDER_ID = OA.SYS_ORDER_ID AND O.ORDER_PLACED_DTTM < TO_DATE(?, 'mmddyyyy hh24:mi:ss') AND O.ORDER_PLACED_DTTM >= TO_DATE(?, 'dd-MM-yyyy hh:mi:ss AM') AND O.STATUS NOT IN ('CANCELLED', 'COMPLETE', 'CANCEL') AND OA.PROCESSING_TYPE_CD = 'H' AND O.SYS_FULFILLMENT_VENDOR_ID IS NULL AND O.SYS_OWNING_LOC_ID = OL.SYS_LOCATION_ID GROUP BY OL.LOCATION_NBR,TO_CHAR(O.ORDER_PLACED_DTTM, 'mm/dd/yyyy')) SELECT NVL(NUM.NUM_COUNT/DENO.DENO_COUNT, 0)PHALPPTC,DENO.DENO_COUNT PHALPPTC_SIZE,DENO.STORE_NBR,DENO.DATE_TIME FROM NUM,DENO WHERE NUM.DATE_TIME (+) = DENO.DATE_TIME AND NUM.STORE_NBR (+)   = DENO.STORE_NBR
# SQL query to fetch data for the flat file
kpi.FlatFileDataQuery.sql=SELECT LOCATION_NBR, KPI_STAT_ID, KPI_SAMPLE_VALUE, KPI_SAMPLE_SIZE, KPI_DATE FROM OM_KPI_ORDER_TRANSACTION \
	WHERE OM_KPI_ORDER_TRANSACTION.KPI_TRANSMISSION_CD IN ('Y' , 'R', 'T') \
	UNION ALL SELECT LOCATION_NBR, KPI_STAT_ID, KPI_SAMPLE_VALUE, KPI_SAMPLE_SIZE, KPI_DATE FROM OM_KPI_POS_PM_TRANSACTION \
	WHERE OM_KPI_POS_PM_TRANSACTION.KPI_TRANSMISSION_CD IN ('Y' , 'R', 'T')
kpi.deploymentdecision.sql = Select PROPERTY_VALUE from OM_ENV_PROPERTIES where PROPERTY_NAME = 'KPI'
#----------------------------- KPI SQL QUERY  ENDS--------------------------------------------#

#For Restart
QUERY_RUN_ALL = WITH JOBS AS (SELECT BATCH_JOB_INSTANCE.JOB_INSTANCE_ID JOBINSTANCE, BATCH_JOB_EXECUTION.JOB_EXECUTION_ID EXECUTIONID, BATCH_JOB_EXECUTION.STATUS, BATCH_JOB_EXECUTION.EXIT_CODE, BATCH_JOB_EXECUTION.START_TIME, DENSE_RANK() over (partition BY BATCH_JOB_INSTANCE.JOB_INSTANCE_ID order by BATCH_JOB_EXECUTION.JOB_EXECUTION_ID DESC) RANK FROM BATCH_JOB_INSTANCE, BATCH_JOB_EXECUTION WHERE BATCH_JOB_INSTANCE.JOB_INSTANCE_ID = BATCH_JOB_EXECUTION.JOB_INSTANCE_ID AND BATCH_JOB_INSTANCE.JOB_NAME = ? AND BATCH_JOB_EXECUTION.START_TIME BETWEEN TO_DATE(? || ' 00:00:00', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59', 'YYYYMMDD HH24:MI:SS') ) SELECT EXECUTIONID FROM JOBS WHERE NOT EXISTS (SELECT 1 FROM BATCH_JOB_INSTANCE, BATCH_JOB_EXECUTION WHERE JOBS.JOBINSTANCE = BATCH_JOB_INSTANCE.JOB_INSTANCE_ID AND BATCH_JOB_INSTANCE.JOB_INSTANCE_ID = BATCH_JOB_EXECUTION.JOB_INSTANCE_ID AND BATCH_JOB_INSTANCE.JOB_NAME = ? AND BATCH_JOB_EXECUTION.STATUS = 'COMPLETED' ) AND RANK = 1 AND STATUS='FAILED' ORDER BY EXECUTIONID 
QUERY_RUN_MOST_RECENT = SELECT JOBS.EXECUTIONID from ( SELECT BATCH_JOB_INSTANCE.JOB_INSTANCE_ID,BATCH_JOB_EXECUTION.JOB_EXECUTION_ID EXECUTIONID, BATCH_JOB_EXECUTION.STATUS,BATCH_JOB_EXECUTION.EXIT_CODE,BATCH_JOB_EXECUTION.START_TIME FROM BATCH_JOB_INSTANCE,BATCH_JOB_EXECUTION where BATCH_JOB_INSTANCE.JOB_INSTANCE_ID = BATCH_JOB_EXECUTION.JOB_INSTANCE_ID and BATCH_JOB_INSTANCE.JOB_NAME = ? and BATCH_JOB_EXECUTION.STATUS ='FAILED' AND BATCH_JOB_EXECUTION.START_TIME BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') order by BATCH_JOB_EXECUTION.START_TIME desc) JOBS where rownum<=1 
QUERY_JOB_RERUN_TYPE = SELECT CODE_ID from OM_CODE_DECODE where CODE_TYPE = 'JobReRunType' and UPPER(TRIM(DECODE)) = UPPER(TRIM(?))

#KRONOS_DEPLOYMENT_PROCESS
KRONOS_DEPLOYMENT_PROCESS = SELECT PROPERTY_VALUE FROM OM_ENV_PROPERTIES WHERE PROPERTY_NAME = 'KRONOS' 

#WEEKLY_STORE_OPENCLOSE_TIME 
WEEKLY_STORE_OPENCLOSE_TIME_ALL_STORE = SELECT SYS_LOCATION_ID, LPAD(LOCATION_NBR, 5, '0') AS LOCATION_NBR, TWENTY_FOUR_HOUR_CD, BUSINESS_TIME_OPEN_SUN, BUSINESS_TIME_OPEN_MON, BUSINESS_TIME_OPEN_TUE,BUSINESS_TIME_OPEN_WED, BUSINESS_TIME_OPEN_THU, BUSINESS_TIME_OPEN_FRI, BUSINESS_TIME_OPEN_SAT, BUSINESS_TIME_CLOSED_SUN, BUSINESS_TIME_CLOSED_MON, BUSINESS_TIME_CLOSED_TUE, BUSINESS_TIME_CLOSED_WED, BUSINESS_TIME_CLOSED_THUS, BUSINESS_TIME_CLOSED_FRI, BUSINESS_TIME_CLOSED_SAT FROM OM_LOCATION WHERE VALID_MWB_STORE_CD = 1 
WEEKLY_STORE_OPENCLOSE_TIME_SEL_STORE = SELECT SYS_LOCATION_ID, LPAD(LOCATION_NBR, 5, '0') AS LOCATION_NBR, TWENTY_FOUR_HOUR_CD, BUSINESS_TIME_OPEN_SUN, BUSINESS_TIME_OPEN_MON, BUSINESS_TIME_OPEN_TUE, BUSINESS_TIME_OPEN_WED, BUSINESS_TIME_OPEN_THU, BUSINESS_TIME_OPEN_FRI, BUSINESS_TIME_OPEN_SAT, BUSINESS_TIME_CLOSED_SUN, BUSINESS_TIME_CLOSED_MON, BUSINESS_TIME_CLOSED_TUE, BUSINESS_TIME_CLOSED_WED, BUSINESS_TIME_CLOSED_THUS, BUSINESS_TIME_CLOSED_FRI, BUSINESS_TIME_CLOSED_SAT FROM OM_LOCATION WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER INNER JOIN OM_PARAMETER_MASTER ON OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID WHERE OM_LOCATION.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND OM_LOCATION.VALID_MWB_STORE_CD = 1 AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= sysdate AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KRONOS' )

#KRONOS_COMPLETED_ORDER
KRONOS_COMPLETED_ORDER_ALL_STORE = WITH QUERYDATE AS ( SELECT DISTINCT TO_CHAR(ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ORDER_DATE FROM OM_ORDER WHERE OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE( ? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ), QUERYA AS ( SELECT NVL(T1.LOCATION_NBR,T2.LOCATION_NBR) LOCATION_NBR, CATEGORY_NAME, NVL(T2.ORDER_COMPLETED_DTTM, TO_DATE( ORDER_DATE, 'MM/DD/YYYY')) ORDER_COMPLETED_DTTM , SLOT FROM (SELECT LOCATION_NBR,CATEGORY_NAME, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_DATE FROM OM_PRODUCT_CATEGORY_LVL1 OM_PRODUCT_CATEGORY_LVL1 INNER JOIN OM_PRODUCT_CATEGORY_TYPE OM_PRODUCT_CATEGORY_TYPE ON OM_PRODUCT_CATEGORY_TYPE.SYS_PRODUCT_CATEGORY_TYPE_ID = OM_PRODUCT_CATEGORY_LVL1.SYS_CATEGORY_TYPE_ID ,OM_LOCATION , QUERYDATE WHERE OM_PRODUCT_CATEGORY_TYPE.PRODUCT_CATEGORY_TYPE = 'MATRIX_CD' AND OM_PRODUCT_CATEGORY_LVL1.CATEGORY_NAME NOT IN ('PHOREC', 'PHOWEB') AND VALID_MWB_STORE_CD = 1 ) T1 LEFT OUTER JOIN (SELECT LOCATION_NBR, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_COMPLETED_DTTM, CEIL(((TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'HH24'))*60+TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'MI')))*60 +  TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'SS')))/(15*60)) SLOT FROM OM_ORDER OM_ORDER INNER JOIN OM_ORDER_LINE OM_ORDER_LINE ON OM_ORDER.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_ORDER.ORDER_PLACED_DTTM = OM_ORDER_LINE.ORDER_PLACED_DTTM INNER JOIN OM_PRODUCT OM_PRODUCT ON OM_ORDER_LINE.SYS_PRODUCT_ID = OM_PRODUCT.SYS_PRODUCT_ID INNER JOIN OM_PRODUCT_PROD_CAT_ASSOC OM_PRODUCT_PROD_CAT_ASSOC ON OM_PRODUCT.SYS_PRODUCT_ID = OM_PRODUCT_PROD_CAT_ASSOC.SYS_PRODUCT_ID INNER JOIN OM_LOCATION OM_LOCATION ON OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID WHERE OM_ORDER.STATUS NOT IN ('PROC', 'CANCEL') AND VALID_MWB_STORE_CD = 1 AND OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE( ? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ) T2 ON T1.SYS_PRODUCT_CATEGORY_LVL1_ID = T2.SYS_PRODUCT_CATEGORY_LVL1_ID AND T1.LOCATION_NBR = T2.LOCATION_NBR AND T1.ORDER_DATE = TO_CHAR(T2.ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ), QUERYB AS (SELECT 'UNITS' AS MEASURE, LPAD(LOCATION_NBR,5, '0') AS LOCATION_NBR, CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM) AS COM_DTTM, CASE WHEN SLOT IS NOT NULL THEN SLOT ||'$' || COUNT(*) END AS SLOT_CNT FROM QUERYA GROUP BY LPAD(LOCATION_NBR,5, '0'), CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM), SLOT), QUERYC AS (SELECT MEASURE, LOCATION_NBR, CATEGORY_NAME, TO_CHAR(COM_DTTM ,'MM/DD/YYYY') AS COMPLETED_DATE, COM_DTTM, TO_CHAR(COM_DTTM, 'DAY') AS DAYNAME, LISTAGG(SLOT_CNT,',') WITHIN GROUP ( ORDER BY SLOT_CNT) AS SLOTANDCOUNT FROM QUERYB GROUP BY MEASURE, LOCATION_NBR, COM_DTTM, CATEGORY_NAME ORDER BY LOCATION_NBR, COM_DTTM ) SELECT * FROM QUERYC 
KRONOS_COMPLETED_ORDER_SEL_STORE = WITH QUERYDATE AS ( SELECT DISTINCT TO_CHAR(ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ORDER_DATE FROM OM_ORDER WHERE OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE( ? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ), QUERYA AS (SELECT NVL(T1.LOCATION_NBR,T2.LOCATION_NBR) LOCATION_NBR, CATEGORY_NAME, NVL(T2.ORDER_COMPLETED_DTTM, TO_DATE( ORDER_DATE, 'MM/DD/YYYY')) ORDER_COMPLETED_DTTM , SLOT FROM (SELECT LOCATION_NBR, CATEGORY_NAME, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_DATE FROM OM_PRODUCT_CATEGORY_LVL1 OM_PRODUCT_CATEGORY_LVL1 INNER JOIN OM_PRODUCT_CATEGORY_TYPE OM_PRODUCT_CATEGORY_TYPE ON OM_PRODUCT_CATEGORY_TYPE.SYS_PRODUCT_CATEGORY_TYPE_ID = OM_PRODUCT_CATEGORY_LVL1.SYS_CATEGORY_TYPE_ID , OM_LOCATION , QUERYDATE WHERE OM_PRODUCT_CATEGORY_TYPE.PRODUCT_CATEGORY_TYPE = 'MATRIX_CD' AND OM_PRODUCT_CATEGORY_LVL1.CATEGORY_NAME NOT IN ('PHOREC', 'PHOWEB') AND VALID_MWB_STORE_CD = 1 ) T1 LEFT OUTER JOIN (SELECT LOCATION_NBR, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_COMPLETED_DTTM, CEIL(((TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'HH24'))*60+TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'MI')))*60 +  TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'SS')))/(15*60)) SLOT FROM OM_ORDER OM_ORDER INNER JOIN OM_ORDER_LINE OM_ORDER_LINE ON OM_ORDER.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_ORDER.ORDER_PLACED_DTTM = OM_ORDER_LINE.ORDER_PLACED_DTTM INNER JOIN OM_PRODUCT OM_PRODUCT ON OM_ORDER_LINE.SYS_PRODUCT_ID = OM_PRODUCT.SYS_PRODUCT_ID INNER JOIN OM_PRODUCT_PROD_CAT_ASSOC OM_PRODUCT_PROD_CAT_ASSOC ON OM_PRODUCT.SYS_PRODUCT_ID = OM_PRODUCT_PROD_CAT_ASSOC.SYS_PRODUCT_ID INNER JOIN OM_LOCATION OM_LOCATION ON OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID WHERE OM_ORDER.STATUS NOT IN ('PROC', 'CANCEL') AND VALID_MWB_STORE_CD = 1 AND OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE( ? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ) T2 ON T1.SYS_PRODUCT_CATEGORY_LVL1_ID = T2.SYS_PRODUCT_CATEGORY_LVL1_ID AND T1.LOCATION_NBR = T2.LOCATION_NBR AND T1.ORDER_DATE = TO_CHAR(T2.ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ), QUERYB AS (SELECT 'UNITS' AS MEASURE, LPAD(LOCATION_NBR,5, '0') AS LOCATION_NBR, CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM) AS COM_DTTM, CASE WHEN SLOT IS NOT NULL THEN SLOT ||'$' || COUNT(*) END AS SLOT_CNT FROM QUERYA WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND QUERYA.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= sysdate AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KRONOS' ) GROUP BY LPAD(LOCATION_NBR,5, '0'), CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM), SLOT ), QUERYC AS (SELECT MEASURE, LOCATION_NBR, CATEGORY_NAME, TO_CHAR(COM_DTTM ,'MM/DD/YYYY') AS COMPLETED_DATE, COM_DTTM, TO_CHAR(COM_DTTM, 'DAY') AS DAYNAME, LISTAGG(SLOT_CNT,',') WITHIN GROUP ( ORDER BY SLOT_CNT) AS SLOTANDCOUNT FROM QUERYB GROUP BY MEASURE, LOCATION_NBR, COM_DTTM, CATEGORY_NAME ORDER BY LOCATION_NBR, COM_DTTM ) SELECT * FROM QUERYC 

#KRONOS_RECEIVING_ORDER
KRONOS_RECEIVING_ORDER_ALL_STORE = WITH QUERYDATE AS ( SELECT DISTINCT TO_CHAR(ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ORDER_DATE FROM OM_ORDER WHERE OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ), QUERYA AS ( SELECT NVL(T1.LOCATION_NBR,T2.LOCATION_NBR) LOCATION_NBR, CATEGORY_NAME, NVL(T2.ORDER_COMPLETED_DTTM, TO_DATE( ORDER_DATE, 'MM/DD/YYYY')) ORDER_COMPLETED_DTTM , SLOT FROM (SELECT LOCATION_NBR,CATEGORY_NAME, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_DATE FROM OM_PRODUCT_CATEGORY_LVL1 OM_PRODUCT_CATEGORY_LVL1 INNER JOIN OM_PRODUCT_CATEGORY_TYPE OM_PRODUCT_CATEGORY_TYPE ON OM_PRODUCT_CATEGORY_TYPE.SYS_PRODUCT_CATEGORY_TYPE_ID = OM_PRODUCT_CATEGORY_LVL1.SYS_CATEGORY_TYPE_ID ,OM_LOCATION , QUERYDATE WHERE OM_PRODUCT_CATEGORY_TYPE.PRODUCT_CATEGORY_TYPE = 'MATRIX_CD' AND OM_PRODUCT_CATEGORY_LVL1.CATEGORY_NAME IN ('PHOREC') AND VALID_MWB_STORE_CD = 1 ) T1 LEFT OUTER JOIN (SELECT LOCATION_NBR, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_COMPLETED_DTTM, CEIL(((TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'HH24'))*60+TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'MI')))*60 +  TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'SS')))/(15*60)) SLOT FROM OM_ORDER OM_ORDER INNER JOIN OM_SHIPMENT ON OM_ORDER.SYS_ORDER_ID = OM_SHIPMENT.SYS_ORDER_ID AND OM_ORDER.ORDER_PLACED_DTTM = OM_SHIPMENT.ORDER_PLACED_DTTM INNER JOIN OM_ORDER_LINE OM_ORDER_LINE ON OM_SHIPMENT.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_SHIPMENT.ORDER_PLACED_DTTM = OM_ORDER_LINE.ORDER_PLACED_DTTM INNER JOIN OM_PRODUCT OM_PRODUCT ON OM_ORDER_LINE.SYS_PRODUCT_ID = OM_PRODUCT.SYS_PRODUCT_ID INNER JOIN OM_PRODUCT_PROD_CAT_ASSOC OM_PRODUCT_PROD_CAT_ASSOC ON OM_PRODUCT.SYS_PRODUCT_ID = OM_PRODUCT_PROD_CAT_ASSOC.SYS_PRODUCT_ID INNER JOIN OM_LOCATION OM_LOCATION ON OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID WHERE OM_ORDER.STATUS NOT IN ('PROC', 'CANCEL') AND VALID_MWB_STORE_CD = 1 AND OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ) T2 ON T1.SYS_PRODUCT_CATEGORY_LVL1_ID = T2.SYS_PRODUCT_CATEGORY_LVL1_ID AND T1.LOCATION_NBR = T2.LOCATION_NBR AND T1.ORDER_DATE = TO_CHAR(T2.ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ), QUERYB AS (SELECT 'UNITS' AS MEASURE, LPAD(LOCATION_NBR,5, '0') AS LOCATION_NBR, CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM) AS COM_DTTM, CASE WHEN SLOT IS NOT NULL THEN SLOT ||'$' || COUNT(*) END AS SLOT_CNT FROM QUERYA GROUP BY LPAD(LOCATION_NBR,5, '0'), CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM), SLOT), QUERYC AS (SELECT MEASURE, LOCATION_NBR, CATEGORY_NAME, TO_CHAR(COM_DTTM ,'MM/DD/YYYY') AS COMPLETED_DATE, COM_DTTM, TO_CHAR(COM_DTTM, 'DAY') AS DAYNAME, LISTAGG(SLOT_CNT,',') WITHIN GROUP ( ORDER BY SLOT_CNT) AS SLOTANDCOUNT FROM QUERYB GROUP BY MEASURE, LOCATION_NBR, COM_DTTM, CATEGORY_NAME ORDER BY LOCATION_NBR, COM_DTTM ) SELECT * FROM QUERYC 
KRONOS_RECEIVING_ORDER_SEL_STORE = WITH QUERYDATE AS ( SELECT DISTINCT TO_CHAR(ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ORDER_DATE FROM OM_ORDER WHERE OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ), QUERYA AS ( SELECT NVL(T1.LOCATION_NBR,T2.LOCATION_NBR) LOCATION_NBR, CATEGORY_NAME, NVL(T2.ORDER_COMPLETED_DTTM, TO_DATE( ORDER_DATE, 'MM/DD/YYYY')) ORDER_COMPLETED_DTTM , SLOT FROM (SELECT LOCATION_NBR,CATEGORY_NAME, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_DATE FROM OM_PRODUCT_CATEGORY_LVL1 OM_PRODUCT_CATEGORY_LVL1 INNER JOIN OM_PRODUCT_CATEGORY_TYPE OM_PRODUCT_CATEGORY_TYPE ON OM_PRODUCT_CATEGORY_TYPE.SYS_PRODUCT_CATEGORY_TYPE_ID = OM_PRODUCT_CATEGORY_LVL1.SYS_CATEGORY_TYPE_ID ,OM_LOCATION , QUERYDATE WHERE OM_PRODUCT_CATEGORY_TYPE.PRODUCT_CATEGORY_TYPE = 'MATRIX_CD' AND OM_PRODUCT_CATEGORY_LVL1.CATEGORY_NAME IN ('PHOREC') AND VALID_MWB_STORE_CD = 1 ) T1 LEFT OUTER JOIN (SELECT LOCATION_NBR, SYS_PRODUCT_CATEGORY_LVL1_ID, ORDER_COMPLETED_DTTM, CEIL(((TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'HH24'))*60+TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'MI')))*60 +  TO_NUMBER(TO_CHAR(ORDER_COMPLETED_DTTM,'SS')))/(15*60)) SLOT FROM OM_ORDER OM_ORDER INNER JOIN OM_SHIPMENT ON OM_ORDER.SYS_ORDER_ID = OM_SHIPMENT.SYS_ORDER_ID AND OM_ORDER.ORDER_PLACED_DTTM = OM_SHIPMENT.ORDER_PLACED_DTTM INNER JOIN OM_ORDER_LINE OM_ORDER_LINE ON OM_SHIPMENT.SYS_ORDER_ID = OM_ORDER_LINE.SYS_ORDER_ID AND OM_SHIPMENT.ORDER_PLACED_DTTM = OM_ORDER_LINE.ORDER_PLACED_DTTM INNER JOIN OM_PRODUCT OM_PRODUCT ON OM_ORDER_LINE.SYS_PRODUCT_ID = OM_PRODUCT.SYS_PRODUCT_ID INNER JOIN OM_PRODUCT_PROD_CAT_ASSOC OM_PRODUCT_PROD_CAT_ASSOC ON OM_PRODUCT.SYS_PRODUCT_ID = OM_PRODUCT_PROD_CAT_ASSOC.SYS_PRODUCT_ID INNER JOIN OM_LOCATION OM_LOCATION ON OM_LOCATION.SYS_LOCATION_ID = OM_ORDER.SYS_OWNING_LOC_ID WHERE OM_ORDER.STATUS NOT IN ('PROC', 'CANCEL') AND VALID_MWB_STORE_CD = 1 AND OM_ORDER.ORDER_PLACED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') - 195 AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') AND OM_ORDER.ORDER_COMPLETED_DTTM BETWEEN TO_DATE(? || ' 00:00:00 ', 'YYYYMMDD HH24:MI:SS') AND TO_DATE(? || ' 23:59:59 ', 'YYYYMMDD HH24:MI:SS') ) T2 ON T1.SYS_PRODUCT_CATEGORY_LVL1_ID = T2.SYS_PRODUCT_CATEGORY_LVL1_ID AND T1.LOCATION_NBR = T2.LOCATION_NBR AND T1.ORDER_DATE = TO_CHAR(T2.ORDER_COMPLETED_DTTM ,'MM/DD/YYYY') ), QUERYB AS (SELECT 'UNITS' AS MEASURE, LPAD(LOCATION_NBR,5, '0') AS LOCATION_NBR, CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM) AS COM_DTTM, CASE WHEN SLOT IS NOT NULL THEN SLOT ||'$' || COUNT(*) END AS SLOT_CNT FROM QUERYA WHERE EXISTS (SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND QUERYA.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= sysdate AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'KRONOS' ) GROUP BY LPAD(LOCATION_NBR,5, '0'), CATEGORY_NAME, TRUNC(ORDER_COMPLETED_DTTM), SLOT ), QUERYC AS (SELECT MEASURE, LOCATION_NBR, CATEGORY_NAME, TO_CHAR(COM_DTTM ,'MM/DD/YYYY') AS COMPLETED_DATE, COM_DTTM, TO_CHAR(COM_DTTM, 'DAY') AS DAYNAME, LISTAGG(SLOT_CNT,',') WITHIN GROUP ( ORDER BY SLOT_CNT) AS SLOTANDCOUNT FROM QUERYB GROUP BY MEASURE, LOCATION_NBR, COM_DTTM, CATEGORY_NAME ORDER BY LOCATION_NBR, COM_DTTM ) SELECT * FROM QUERYC 

#----------------------------- KRONOS SQL QUERY  Ends--------------------------------------------#

#----------------------------- Daily MSS SQL QUERY  STARTS --------------------------------------------#

MSS_DEPLOYMENT_PROCESS = SELECT PROPERTY_VALUE FROM OM_ENV_PROPERTIES WHERE UPPER(PROPERTY_NAME) = 'MSS' 

MSS_UPDATE_PRE_FLAG_SEL_STORE_WITH_BEGIN = UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD = 'I' WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE >= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD NOT IN ('Y') 

MSS_UPDATE_PRE_FLAG_SEL_STORE_WITHOUT_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD = 'I' WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD NOT IN ('Y') 

MSS_UPDATE_PRE_FLAG_ALL_STORE_WITH_BEGIN = UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD = 'I' WHERE  BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE >= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD NOT IN ('Y') 

MSS_UPDATE_PRE_FLAG_ALL_STORE_WITHOUT_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD = 'I' WHERE  BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD NOT IN ('Y') 

MSS_FLAT_FILE_DATA_SEL_STORE_WITH_BEGIN = SELECT LPAD(LOCATION_NBR, 5, 0)|| LPAD(WIC_NBR, 6, 0)|| LPAD(UPC_NBR, 14, 0)|| TO_CHAR(BUSINESS_DATE, 'YYYYMMDD')|| LPAD(ROUND(SLS_UNITS,2)*100, 8,' ')||LPAD(ROUND(SLS_DLR,2)   *100, 8,' ')||LPAD(ROUND(COST_DLR,4)  *10000, 10,' ') MSS_FEED FROM (SELECT LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE,SUM(SALES_UNITS) SLS_UNITS, SUM(SALES_DOLLARS) SLS_DLR, SUM(COST_DOLLARS) COST_DLR FROM OM_POS_TRANS_BY_WIC_UPC POSWIC WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND MSS_TRANSFER_CD='I' AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE >= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') GROUP BY LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE) 
 
MSS_FLAT_FILE_DATA_SEL_STORE_WITHOUT_BEGIN = SELECT LPAD(LOCATION_NBR, 5, 0)|| LPAD(WIC_NBR, 6, 0)|| LPAD(UPC_NBR, 14, 0)|| TO_CHAR(BUSINESS_DATE, 'YYYYMMDD')|| LPAD(ROUND(SLS_UNITS,2)*100, 8,' ')||LPAD(ROUND(SLS_DLR,2)   *100, 8,' ')||LPAD(ROUND(COST_DLR,4)  *10000, 10,' ') MSS_FEED FROM (SELECT LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE,SUM(SALES_UNITS) SLS_UNITS, SUM(SALES_DOLLARS) SLS_DLR, SUM(COST_DOLLARS) COST_DLR FROM OM_POS_TRANS_BY_WIC_UPC POSWIC WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND MSS_TRANSFER_CD='I' AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')  GROUP BY LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE)

MSS_FLAT_FILE_DATA_ALL_STORE_WITH_BEGIN = SELECT LPAD(LOCATION_NBR, 5, 0)|| LPAD(WIC_NBR, 6, 0)|| LPAD(UPC_NBR, 14, 0)|| TO_CHAR(BUSINESS_DATE, 'YYYYMMDD')|| LPAD(ROUND(SLS_UNITS,2)*100, 8,' ')||LPAD(ROUND(SLS_DLR,2)   *100, 8,' ')||LPAD(ROUND(COST_DLR,4)  *10000, 10,' ') MSS_FEED FROM (SELECT LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE,SUM(SALES_UNITS) SLS_UNITS, SUM(SALES_DOLLARS) SLS_DLR, SUM(COST_DOLLARS) COST_DLR FROM OM_POS_TRANS_BY_WIC_UPC WHERE MSS_TRANSFER_CD='I' AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE >= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') GROUP BY LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE) 
 
MSS_FLAT_FILE_DATA_ALL_STORE_WITHOUT_BEGIN = SELECT LPAD(LOCATION_NBR, 5, 0)|| LPAD(WIC_NBR, 6, 0)|| LPAD(UPC_NBR, 14, 0)|| TO_CHAR(BUSINESS_DATE, 'YYYYMMDD')|| LPAD(ROUND(SLS_UNITS,2)*100, 8,' ')||LPAD(ROUND(SLS_DLR,2)   *100, 8,' ')||LPAD(ROUND(COST_DLR,4)  *10000, 10,' ') MSS_FEED FROM (SELECT LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE,SUM(SALES_UNITS) SLS_UNITS, SUM(SALES_DOLLARS) SLS_DLR, SUM(COST_DOLLARS) COST_DLR FROM OM_POS_TRANS_BY_WIC_UPC WHERE MSS_TRANSFER_CD='I' AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS')  GROUP BY LOCATION_NBR, WIC_NBR, UPC_NBR, BUSINESS_DATE)

MSS_UPDATE_POST_FLAG_SEL_STORE_WITH_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD='Y' , MSS_TRANSMISSION_DATE= TO_DATE(?,'YYYYMMDD HH24MISS') , UPDATE_USER_ID='MSS' , UPDATE_DTTM=SYSDATE WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE > TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD IN ('I') 

MSS_UPDATE_POST_FLAG_SEL_STORE_WITHOUT_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD='Y' , MSS_TRANSMISSION_DATE= TO_DATE(?,'YYYYMMDD HH24MISS'), UPDATE_USER_ID='MSS' , UPDATE_DTTM=SYSDATE WHERE EXISTS ( SELECT 1 FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'MSS' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'YYYYMMDD') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = POSWIC.LOCATION_NBR ) AND BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD IN ('I') 

MSS_UPDATE_POST_FLAG_ALL_STORE_WITH_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD='Y' , MSS_TRANSMISSION_DATE= TO_DATE(?,'YYYYMMDD HH24MISS') , UPDATE_USER_ID='MSS' , UPDATE_DTTM=SYSDATE WHERE  BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND BUSINESS_DATE > TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD IN ('I') 

MSS_UPDATE_POST_FLAG_ALL_STORE_WITHOUT_BEGIN =  UPDATE OM_POS_TRANS_BY_WIC_UPC POSWIC SET MSS_TRANSFER_CD='Y' , MSS_TRANSMISSION_DATE= TO_DATE(?,'YYYYMMDD HH24MISS'), UPDATE_USER_ID='MSS' , UPDATE_DTTM=SYSDATE WHERE  BUSINESS_DATE <= TO_DATE(?,'YYYY-MM-DD HH24:MI:SS') AND MSS_TRANSFER_CD IN ('I') 

#----------------------------- Daily MSS SQL QUERY  ENDS --------------------------------------------#

# Read PropertyValue from OM_ENV_PROPERTY for T&A
GET_PROP_VALUE = SELECT PROPERTY_VALUE FROM OM_ENV_PROPERTIES WHERE PROPERTY_NAME = 'TA' AND PROPERTY_TYPE = 'Chain'

#TIME_AND_ATTENDANCE_POPULATE_DATA_SPECIFIC_STORE
TIME_AND_ATTENDANCE_POPULATE_DATA_SPECIFIC_STORE = SELECT COUNT(*) OVER() AS TOTAL_RECORDS , EMPLOYEE_ID          AS EMPLOYEE_ID, SUM(EARNED_AMOUNT)   AS DOLLAR_PM_AMOUNT, EFFECTIVE_DATE , LOCATION_NBR AS STORE_NUMBER ,  SYS_ORDER_ID FROM (SELECT e.EMPLOYEE_ID, D.LOCATION_NBR, A.EARNED_AMOUNT, A.TIME_ATTENDANCE_CD, A.REPORT_SENT_DTTM, NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS EFFECTIVE_DATE,  A.SYS_ORDER_ID, 'ORDER' AS Type, C.SYS_ORDER_ATTRIBUTE_ID FROM OM_ORDER_PM A, OM_ORDER B,  OM_ORDER_ATTRIBUTE C,  OM_LOCATION D, OM_USER_ATTRIBUTES E WHERE EXISTS (SELECT 1  FROM OM_STORE_PARAMETER, OM_PARAMETER_MASTER WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID AND Om_Parameter_Master.Parameter_Name = 'TA'  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE AND OM_STORE_PARAMETER.LOCATION_NBR = D.LOCATION_NBR ) AND A.Sys_Order_Id         = B.Sys_Order_Id AND A.ORDER_PLACED_DTTM    = B.ORDER_PLACED_DTTM AND B.SYS_ORDER_ID         = C.SYS_ORDER_ID AND B.ORDER_PLACED_DTTM    = C.ORDER_PLACED_DTTM AND B.SYS_OWNING_LOC_ID    = D.SYS_LOCATION_ID AND A.Sys_Employee_Id      = E.Sys_User_Id AND A.Sys_Product_Id      <> 0 AND ((C.Pm_Status          = 'E' AND (A.Time_Attendance_Cd IS NULL AND A.REPORT_SENT_DTTM    IS NULL) OR (A.Time_Attendance_Cd   = 'I' AND A.REPORT_SENT_DTTM    IS NOT NULL)) OR (C.Pm_Status            = 'T' AND A.Time_Attendance_Cd   = 'R' AND A.REPORT_SENT_DTTM    IS NOT NULL)) AND C.Order_Placed_Dttm    > Sysdate - 210 AND A.ACTIVE_CD            = 1  UNION ALL SELECT e.EMPLOYEE_ID,   D.LOCATION_NBR,  A.EARNED_AMOUNT, A.TIME_ATTENDANCE_CD, A.REPORT_SENT_DTTM,  NVL(B.Order_Sold_Dttm,Sysdate - 1) AS Effective_Date, A.SYS_ORDER_ID,  'SC' AS TYPE, F.SYS_SHOPPING_CART_ID FROM OM_ORDER_PM A,   Om_Order B,   OM_ORDER_ATTRIBUTE C,  OM_SHOPPING_CART F,  OM_LOCATION D,   OM_USER_ATTRIBUTES E WHERE EXISTS   (SELECT 1 FROM OM_STORE_PARAMETER,  OM_PARAMETER_MASTER  WHERE OM_STORE_PARAMETER.SYS_PARAMETER_ID                    = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND OM_PARAMETER_MASTER.PARAMETER_NAME                       = 'TA' AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_STORE_PARAMETER.LOCATION_NBR  = D.LOCATION_NBR ) AND A.Sys_Order_Id         = B.Sys_Order_Id AND A.Order_Placed_Dttm    = B.Order_Placed_Dttm AND B.Sys_Order_Id         = C.Sys_Order_Id AND B.Order_Placed_Dttm    = C.Order_Placed_Dttm AND C.SYS_SHOPPING_CART_ID = F.SYS_SHOPPING_CART_ID AND C.ORDER_PLACED_DTTM    = F.ORDER_PLACED_DTTM AND B.SYS_OWNING_LOC_ID    = D.SYS_LOCATION_ID AND A.SYS_EMPLOYEE_ID      = E.SYS_USER_ID AND A.Sys_Product_Id       = 0 AND ((F.PM_STATUS_CD       = 'E' AND (A.Time_Attendance_Cd IS NULL AND A.REPORT_SENT_DTTM    IS NULL)  OR (A.Time_Attendance_Cd   = 'I' AND A.REPORT_SENT_DTTM    IS NOT NULL)) OR (F.PM_STATUS_CD         = 'T' AND A.Time_Attendance_Cd   = 'R' AND A.REPORT_SENT_DTTM    IS NOT NULL)) AND C.ORDER_PLACED_DTTM    > SYSDATE - 210 AND A.ACTIVE_CD            = 1 ) GROUP BY EMPLOYEE_ID, LOCATION_NBR, Sys_Order_Id, EFFECTIVE_DATE
#SELECT COUNT(*) OVER() AS TOTAL_RECORDS ,  EMPLOYEE_ID          AS EMPLOYEE_ID,  SUM(EARNED_AMOUNT)   AS DOLLAR_PM_AMOUNT,  MAX(x)              AS EFFECTIVE_DATE ,  'PHOTO PM'  AS PAY_CODE_NAME,  LOCATION_NBR    AS STORE_NUMBER ,  ' '             AS COMMENT_TEXT,  ' '             AS STORE_FEED_CODE ,   sys_order_id  AS SYS_ORDER_ID FROM  (SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'ORDER' AS Type,    C.Sys_Order_attribute_Id  FROM Om_Order_Pm A,    Om_Order B,    OM_ORDER_ATTRIBUTE C,    OM_LOCATION D,    om_user_attributes e,     OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id      = B.Sys_Order_Id  AND A.Order_Placed_Dttm   = B.Order_Placed_Dttm  AND B.Sys_Order_Id        = C.Sys_Order_Id  AND B.Order_Placed_Dttm   = C.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id   = D.Sys_Location_Id  AND A.Sys_Employee_Id     = E.Sys_User_Id  AND A.sys_product_id     <> 0  AND C.Pm_Status           = 'E'  AND A.Time_Attendance_Cd IS NULL  AND A.Report_Sent_Dttm   IS NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  UNION ALL  SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'ORDER' AS Type,    C.Sys_Order_attribute_Id  FROM Om_Order_Pm A,    Om_Order B,    OM_ORDER_ATTRIBUTE C,    OM_LOCATION D,    om_user_attributes e,     OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id     = B.Sys_Order_Id  AND A.Order_Placed_Dttm  = B.Order_Placed_Dttm  AND B.Sys_Order_Id       = C.Sys_Order_Id  AND B.Order_Placed_Dttm  = C.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id  = D.Sys_Location_Id  AND A.Sys_Employee_Id    = E.Sys_User_Id  AND A.sys_product_id    <> 0  AND C.Pm_Status          = 'E'  AND A.Time_Attendance_Cd = 'I'  AND A.Report_Sent_Dttm  IS NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  UNION ALL  SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'ORDER' AS Type,    C.Sys_Order_attribute_Id  FROM Om_Order_Pm A,    Om_Order B,    OM_ORDER_ATTRIBUTE C,    OM_LOCATION D,    om_user_attributes e,     OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id     = B.Sys_Order_Id  AND A.Order_Placed_Dttm  = B.Order_Placed_Dttm  AND B.Sys_Order_Id       = C.Sys_Order_Id  AND B.Order_Placed_Dttm  = C.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id  = D.Sys_Location_Id  AND A.Sys_Employee_Id    = E.Sys_User_Id  AND A.sys_product_id    <> 0  AND C.Pm_Status          = 'T'  AND A.Time_Attendance_Cd = 'R'  AND A.Report_Sent_Dttm  IS NOT NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  UNION ALL  SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'SC' AS Type,    f.sys_shopping_cart_id  FROM Om_Order_Pm A,    Om_Order B,    Om_Order_Attribute C,    Om_Shopping_Cart f,    OM_LOCATION D,    om_user_attributes e,     OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id       = B.Sys_Order_Id  AND A.Order_Placed_Dttm    = B.Order_Placed_Dttm  AND B.Sys_Order_Id         = C.Sys_Order_Id  AND B.Order_Placed_Dttm    = C.Order_Placed_Dttm  AND C.Sys_Shopping_Cart_Id = F.Sys_Shopping_Cart_Id  AND C.Order_Placed_Dttm    = F.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id    = D.Sys_Location_Id  AND A.Sys_Employee_Id      = E.Sys_User_Id  AND A.sys_product_id       = 0  AND C.Pm_Status            = 'E'  AND A.Time_Attendance_Cd  IS NULL  AND A.Report_Sent_Dttm    IS NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  UNION ALL  SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'SC' AS Type,    f.sys_shopping_cart_id  FROM Om_Order_Pm A,    Om_Order B,    Om_Order_Attribute C,    Om_Shopping_Cart f,    OM_LOCATION D,    om_user_attributes e,     OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id       = B.Sys_Order_Id  AND A.Order_Placed_Dttm    = B.Order_Placed_Dttm  AND B.Sys_Order_Id         = C.Sys_Order_Id  AND B.Order_Placed_Dttm    = C.Order_Placed_Dttm  AND C.Sys_Shopping_Cart_Id = F.Sys_Shopping_Cart_Id  AND C.Order_Placed_Dttm    = F.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id    = D.Sys_Location_Id  AND A.Sys_Employee_Id      = E.Sys_User_Id  AND A.sys_product_id       = 0  AND C.Pm_Status            = 'E'  AND A.Time_Attendance_Cd   = 'I'  AND A.Report_Sent_Dttm    IS NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  UNION ALL  SELECT e.EMPLOYEE_ID,    D.LOCATION_NBR,    A.EARNED_AMOUNT,    A.TIME_ATTENDANCE_CD,    A.REPORT_SENT_DTTM,    NVL(B.ORDER_SOLD_DTTM,SYSDATE - 1) AS x,    'PHOTO PM'                         AS PAY_CODE_NAME,    ' '                                AS Comment_Text,    ' '                                AS Store_Feed_Code ,    A.sys_order_id,    'SC' AS Type,    f.sys_shopping_cart_id  FROM Om_Order_Pm A,    Om_Order B,    Om_Order_Attribute C,    Om_Shopping_Cart f,    OM_LOCATION D,    om_user_attributes e,    OM_STORE_PARAMETER,OM_PARAMETER_MASTER  WHERE A.Sys_Order_Id       = B.Sys_Order_Id  AND A.Order_Placed_Dttm    = B.Order_Placed_Dttm  AND B.Sys_Order_Id         = C.Sys_Order_Id  AND B.Order_Placed_Dttm    = C.Order_Placed_Dttm  AND C.Sys_Shopping_Cart_Id = F.Sys_Shopping_Cart_Id  AND C.Order_Placed_Dttm    = F.Order_Placed_Dttm  AND B.Sys_Owning_Loc_Id    = D.Sys_Location_Id  AND A.Sys_Employee_Id      = E.Sys_User_Id  AND A.sys_product_id       = 0  AND C.Pm_Status            = 'T'  AND A.Time_Attendance_Cd   = 'R'  AND A.Report_Sent_Dttm    IS NOT NULL  AND OM_STORE_PARAMETER.SYS_PARAMETER_ID = OM_PARAMETER_MASTER.SYS_PARAMETER_ID  AND D.LOCATION_NBR = OM_STORE_PARAMETER.LOCATION_NBR  AND TO_DATE(OM_STORE_PARAMETER.PARAMETER_VALUE, 'MM/DD/YYYY') <= SYSDATE  AND OM_PARAMETER_MASTER.PARAMETER_NAME = 'TA'  AND C.ORDER_PLACED_DTTM > To_Date( sysdate , 'dd-mm-yyyy') - 210  AND A.ACTIVE_CD  = 1  ) GROUP BY EMPLOYEE_ID, LOCATION_NBR, SYS_ORDER_ID   

#----------------------------- Pos Reconciliation deployment process queries ---------------------------------#
  
POS_RECONCILIATION_DEPLOYMENT_PROCESS = SELECT PROPERTY_VALUE FROM OM_ENV_PROPERTIES WHERE UPPER(PROPERTY_NAME) = 'POS_RECON'
  
